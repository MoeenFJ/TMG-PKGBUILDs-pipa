# Maintainer: LinusDierheimer <Linus@Dierheimer.de>

pkgname=pipa-kernel-hooks
pkgver=1.0
pkgrel=1
pkgdesc="Pacman hooks to build and deploy kernel on Xiaomi Pad 6 [Pipa]"
arch=("any")
url=""
license=("GPL")

depends=(
	"coreutils"
    "mkbootimg-pipa"
    "qbootctl"
    "linux-pipa"
    "linux-firmware-pipa-adreno"
    "linux-firmware-pipa-adsp"
    "linux-firmware-pipa-cdsp"
    "linux-firmware-pipa-awinic"
    "linux-firmware-pipa-nuvolta"
    "linux-firmware-pipa-novatek"
    "linux-firmware-pipa-hexagonfs"
    "linux-firmware-pipa-slpi"
    "linux-firmware-pipa-venus"

)
optdepends=(
  "mkinitcpio: build the initramfs"
  "linux: default linux preset"
)
source=(
    "91-install-kernel.hook"
    "flashkernel.sh"
    "pipafw-initcpio-hook"
    "mkinitcpio.conf"
)
sha512sums=(
"6bb90cfdfc4a81f271e9b5bd41280ac5256d6d928044a87c91b0607d3261d3ce0ca3f5e2a7a476aa2a58283aa5acc658849b90e5c746a8f7c46e2591ebbb87f9"
"304b9c1174b0210291649a84fa86538a172425b83eac21acf818dcc97dc3b4d79fb6d68f3089f9744dd93819036fece5dd1a99fa571cdec042b136362baf45a9"
"cbc51477d97d57dbc078f5728e35f022f25ec2a1224c5fc0f143c63d765b0eb01f21765db8d51fb77a33fc0dad6bceb21693c45e85262f9e20b134e82a498d5a"
"3fbd32f5829dadbf308e0fc9fd66d1a2e8793d81d2fe1c31678eab0bda8836ada08f318bb90ac460466e83eee2e45c49ceb22421abe99b8f6bfa8d4bbf45a696"
)

backup=('etc/mkinitcpio.conf')

package() {
	# Pacman hook, run flashkernel whenever ramdisk or kernel is updated
    install -Dm644 "91-install-kernel.hook" "$pkgdir/usr/share/libalpm/hooks/91-install-kernel.hook"
    install -Dm755 "flashkernel.sh" "$pkgdir/usr/bin/flashkernel.sh"
    
   	# Install initcpio hooks to add fw to ramdisk
    install -Dm644 "pipafw-initcpio-hook" "$pkgdir/usr/lib/initcpio/install/pipafw"

    # Add mkinitcpio conf
    install -Dm644 "mkinitcpio.conf" "$pkgdir/etc/mkinitcpio.conf.d/pipa.conf"
}
